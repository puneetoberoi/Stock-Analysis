name: Test Learning Brain Module

on:
  push:
    paths:
      - 'src/modules/**'
      - '.github/workflows/test_learning_brain.yml'
  workflow_dispatch:  # Allow manual trigger

jobs:
  test-learning-brain:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: Install dependencies
        run: |
          pip install yfinance sqlite3-cli
          pip install pandas numpy
          
      - name: Create directories
        run: |
          mkdir -p src/modules/data
          
      - name: Run Learning Brain Test
        run: |
          cd src/modules
          python learning_brain.py
          
      - name: Show Database Info
        run: |
          echo "ðŸ“Š Database Tables:"
          sqlite3 src/modules/data/learning.db ".tables"
          echo ""
          echo "ðŸ“ Predictions Table:"
          sqlite3 src/modules/data/learning.db "SELECT * FROM predictions;"
          echo ""
          echo "ðŸ“ˆ Accuracy Tracking:"
          sqlite3 src/modules/data/learning.db "SELECT * FROM accuracy_tracking;"
          
      - name: Upload Database as Artifact
        uses: actions/upload-artifact@v3
        with:
          name: learning-database
          path: src/modules/data/learning.db
          retention-days: 30
          
      - name: Create Test Report
        run: |
          echo "# Learning Brain Test Report" > test_report.md
          echo "## Test Run: $(date)" >> test_report.md
          echo "### Database Created Successfully âœ…" >> test_report.md
          echo '```' >> test_report.md
          sqlite3 src/modules/data/learning.db ".schema" >> test_report.md
          echo '```' >> test_report.md
          
      - name: Upload Test Report
        uses: actions/upload-artifact@v3
        with:
          name: test-report
          path: test_report.md
